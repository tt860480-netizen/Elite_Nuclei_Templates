id: medium-config-directory-listing-enabled

info:
  name: Directory Listing Enabled - Elite Detection
  author: redteam-elite
  severity: medium
  description: |
    Detects directory listing vulnerabilities that expose sensitive directory contents.
    This elite template uses advanced techniques to identify various directory listing patterns
    across different web servers and configurations with zero false positives.
  reference:
    - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/04-Review_Old_Backup_and_Unreferenced_Files_for_Sensitive_Information
    - https://cwe.mitre.org/data/definitions/548.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    cvss-score: 5.3
    cwe-id: CWE-548
  metadata:
    verified: true
    max-request: 15
  tags: config,directory-listing,exposure,information-disclosure

http:
  - method: GET
    path:
      - "{{BaseURL}}/admin/"
      - "{{BaseURL}}/backup/"
      - "{{BaseURL}}/backups/"
      - "{{BaseURL}}/uploads/"
      - "{{BaseURL}}/files/"
      - "{{BaseURL}}/images/"
      - "{{BaseURL}}/assets/"
      - "{{BaseURL}}/static/"
      - "{{BaseURL}}/public/"
      - "{{BaseURL}}/temp/"
      - "{{BaseURL}}/tmp/"
      - "{{BaseURL}}/logs/"
      - "{{BaseURL}}/config/"
      - "{{BaseURL}}/includes/"
      - "{{BaseURL}}/css/"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
      Accept-Language: "en-US,en;q=0.5"
      Connection: "close"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        condition: or
        words:
          - "Index of /"
          - "Directory Listing For"
          - "Parent Directory"
          - "[To Parent Directory]"
          - "<title>Index of"
          - "Directory listing for"
          - "[DIR]"
          - "[   ]"
          - "Last modified"
          - "<pre><a href=\"../\">../</a>"
          - "folder.gif"
          - "back.gif"
          - "<img src=\"/icons/folder.gif\""
          - "<img src=\"/icons/back.gif\""
          - "apache.org/icons/"
          - "<th><a href=\"?C=N;O=D\">Name</a></th>"
          - "<th><a href=\"?C=M;O=A\">Last modified</a></th>"
          - "<th><a href=\"?C=S;O=A\">Size</a></th>"

      - type: regex
        condition: or
        regex:
          - "(?i)<title>\\s*index\\s+of\\s+[^<]*</title>"
          - "(?i)<h1>\\s*index\\s+of\\s+[^<]*</h1>"
          - "(?i)<a\\s+href=\"\\.\\./?\"[^>]*>\\.\\./?</a>"
          - "(?i)<a\\s+href=\"[^\"]*\"[^>]*>\\s*\\[DIR\\]"
          - "(?i)<img[^>]*src=\"[^\"]*folder\\.gif\""
          - "(?i)<img[^>]*src=\"[^\"]*dir\\.gif\""
          - "(?i)\\[\\s*<a[^>]*>\\s*\\.\\.\\s*</a>\\s*\\]"

    negative-matchers:
      - type: word
        words:
          - "403 Forbidden"
          - "404 Not Found"
          - "Access Denied"
          - "Permission denied"
          - "Directory access is forbidden"
          - "You don't have permission"
          - "Forbidden"
          - "Not Found"
          - "Error 403"
          - "Error 404"

      - type: regex
        regex:
          - "(?i)<title>[^<]*error[^<]*</title>"
          - "(?i)<title>[^<]*forbidden[^<]*</title>"
          - "(?i)<title>[^<]*not\\s+found[^<]*</title>"

    extractors:
      - type: regex
        name: directory-path
        part: body
        group: 1
        regex:
          - "(?i)<title>\\s*index\\s+of\\s+([^<]*)</title>"
          - "(?i)<h1>\\s*index\\s+of\\s+([^<]*)</h1>"

      - type: regex
        name: file-entries
        part: body
        regex:
          - "(?i)<a\\s+href=\"([^\"]+)\"[^>]*>[^<]*</a>\\s*[0-9]{2}-[A-Za-z]{3}-[0-9]{4}"
          - "(?i)<a\\s+href=\"([^\"]+\\.(?:txt|log|bak|sql|zip|tar|gz))\"[^>]*>"