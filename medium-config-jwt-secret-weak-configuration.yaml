id: medium-config-jwt-secret-weak-configuration

info:
  name: JWT Secret Weak Configuration Detection
  author: elite-red-team
  severity: medium
  description: |
    Detects weak JWT secret configurations including hardcoded secrets, weak keys,
    and exposed JWT configurations. This elite template identifies various JWT
    implementation vulnerabilities that can lead to token forgery and authentication bypass.
  reference:
    - https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication
    - https://auth0.com/blog/a-look-at-the-latest-draft-for-jwt-bcp/
    - https://tools.ietf.org/html/rfc7519
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-798
  metadata:
    verified: true
    max-request: 8
  tags: config,jwt,secret,weak-key,authentication,token,medium

http:
  # Test for exposed JWT configuration files
  - method: GET
    path:
      - "{{BaseURL}}/config/jwt.json"
      - "{{BaseURL}}/config/auth.json"
      - "{{BaseURL}}/config/token.json"
      - "{{BaseURL}}/jwt.json"
      - "{{BaseURL}}/auth.json"
      - "{{BaseURL}}/token.json"
      - "{{BaseURL}}/config/jwt.js"
      - "{{BaseURL}}/config/auth.js"
      - "{{BaseURL}}/config/token.js"
      - "{{BaseURL}}/jwt.js"
      - "{{BaseURL}}/auth.js"
      - "{{BaseURL}}/token.js"
      - "{{BaseURL}}/config/jwt.php"
      - "{{BaseURL}}/config/auth.php"
      - "{{BaseURL}}/jwt.php"
      - "{{BaseURL}}/auth.php"
      - "{{BaseURL}}/config/jwt.py"
      - "{{BaseURL}}/config/auth.py"
      - "{{BaseURL}}/jwt.py"
      - "{{BaseURL}}/auth.py"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "application/json,text/plain,application/javascript,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # JWT configuration with weak secrets
      - type: regex
        part: body
        regex:
          # Common weak JWT secrets
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?(secret|password|123456|admin|test|demo|key|jwt|token|auth|default|changeme|qwerty|abc123|password123|admin123|test123|demo123|secret123|key123|jwt123|token123|auth123|default123|changeme123|your-256-bit-secret|your-secret-key|my-secret|super-secret|top-secret|ultra-secret|mega-secret|hyper-secret|crypto-secret|secure-secret|private-secret|confidential-secret|classified-secret|restricted-secret|sensitive-secret|protected-secret|hidden-secret|stealth-secret|ninja-secret|ghost-secret|phantom-secret|shadow-secret|dark-secret|black-secret|void-secret|null-secret|empty-secret|blank-secret|zero-secret|one-secret|two-secret|three-secret|four-secret|five-secret|six-secret|seven-secret|eight-secret|nine-secret|ten-secret)[\"']?"
          
          # Short secrets (less than 32 characters)
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?[A-Za-z0-9]{1,31}[\"']?"
          
          # Hardcoded JWT secrets in various formats
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?[A-Za-z0-9+/=_-]{8,64}[\"']?"
          
          # Environment variables with weak values
          - "(?i)(JWT_SECRET|JWT_KEY|SECRET_KEY|SIGNING_KEY|TOKEN_SECRET|AUTH_SECRET)\\s*[=:]\\s*[\"']?(secret|password|123456|admin|test|demo|key|jwt|token|auth|default|changeme)[\"']?"
          
          # JWT algorithm configuration (weak algorithms)
          - "(?i)(algorithm|alg)\\s*[=:]\\s*[\"']?(none|HS256|RS256)[\"']?"
          
          # JWT configuration objects
          - '(?i)"(secret|key|secretOrKey|secretOrPrivateKey)"\\s*:\\s*"[^"]{1,31}"'
          - '(?i)"algorithm"\\s*:\\s*"(none|HS256)"'
          
        condition: or

    extractors:
      - type: regex
        part: body
        group: 2
        regex:
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?([A-Za-z0-9+/=_-]+)[\"']?"

      - type: regex
        part: body
        group: 2
        regex:
          - '(?i)"(secret|key|secretOrKey|secretOrPrivateKey)"\\s*:\\s*"([^"]+)"'

  # Test for environment files with JWT secrets
  - method: GET
    path:
      - "{{BaseURL}}/.env"
      - "{{BaseURL}}/.env.local"
      - "{{BaseURL}}/.env.development"
      - "{{BaseURL}}/.env.production"
      - "{{BaseURL}}/.env.example"
      - "{{BaseURL}}/.env.sample"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "text/plain,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # Environment variables with JWT secrets
      - type: regex
        part: body
        regex:
          # Weak JWT secrets in environment variables
          - "(?i)(JWT_SECRET|JWT_KEY|SECRET_KEY|SIGNING_KEY|TOKEN_SECRET|AUTH_SECRET|ACCESS_TOKEN_SECRET|REFRESH_TOKEN_SECRET)\\s*=\\s*[\"']?(secret|password|123456|admin|test|demo|key|jwt|token|auth|default|changeme|qwerty|abc123|password123|admin123|test123|demo123|secret123|key123|jwt123|token123|auth123|default123|changeme123|your-256-bit-secret|your-secret-key|my-secret|super-secret)[\"']?"
          
          # Short secrets in environment variables
          - "(?i)(JWT_SECRET|JWT_KEY|SECRET_KEY|SIGNING_KEY|TOKEN_SECRET|AUTH_SECRET|ACCESS_TOKEN_SECRET|REFRESH_TOKEN_SECRET)\\s*=\\s*[\"']?[A-Za-z0-9]{1,31}[\"']?"
          
          # JWT algorithm configuration
          - "(?i)(JWT_ALGORITHM|JWT_ALG|TOKEN_ALGORITHM|AUTH_ALGORITHM)\\s*=\\s*[\"']?(none|HS256)[\"']?"
          
        condition: or

    extractors:
      - type: regex
        part: body
        group: 2
        regex:
          - "(?i)(JWT_SECRET|JWT_KEY|SECRET_KEY|SIGNING_KEY|TOKEN_SECRET|AUTH_SECRET|ACCESS_TOKEN_SECRET|REFRESH_TOKEN_SECRET)\\s*=\\s*[\"']?([A-Za-z0-9+/=_-]+)[\"']?"

  # Test for source code files with hardcoded JWT secrets
  - method: GET
    path:
      - "{{BaseURL}}/src/auth/jwt.js"
      - "{{BaseURL}}/src/config/jwt.js"
      - "{{BaseURL}}/src/middleware/auth.js"
      - "{{BaseURL}}/src/utils/jwt.js"
      - "{{BaseURL}}/lib/jwt.js"
      - "{{BaseURL}}/lib/auth.js"
      - "{{BaseURL}}/lib/token.js"
      - "{{BaseURL}}/includes/jwt.php"
      - "{{BaseURL}}/includes/auth.php"
      - "{{BaseURL}}/includes/token.php"
      - "{{BaseURL}}/app/auth.py"
      - "{{BaseURL}}/app/jwt.py"
      - "{{BaseURL}}/app/token.py"
      - "{{BaseURL}}/utils/jwt.py"
      - "{{BaseURL}}/utils/auth.py"
      - "{{BaseURL}}/config/auth.rb"
      - "{{BaseURL}}/config/jwt.rb"
      - "{{BaseURL}}/lib/jwt.rb"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "text/plain,application/javascript,application/x-php,text/x-python,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # Source code with hardcoded JWT secrets
      - type: regex
        part: body
        regex:
          # JavaScript/Node.js patterns
          - "(?i)(const|let|var)\\s+[a-zA-Z_][a-zA-Z0-9_]*\\s*=\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          - "(?i)jwt\\.sign\\s*\\([^,]+,\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          - "(?i)jwt\\.verify\\s*\\([^,]+,\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          - "(?i)(secret|secretOrKey|secretOrPrivateKey)\\s*:\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          
          # PHP patterns
          - "(?i)\\$[a-zA-Z_][a-zA-Z0-9_]*\\s*=\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          - "(?i)JWT::(encode|decode)\\s*\\([^,]+,\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          
          # Python patterns
          - "(?i)[A-Z_]+\\s*=\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          - "(?i)jwt\\.(encode|decode)\\s*\\([^,]+,\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          
          # Ruby patterns
          - "(?i)[A-Z_]+\\s*=\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          - "(?i)JWT\\.(encode|decode)\\s*\\([^,]+,\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          
          # Java patterns
          - "(?i)(public|private|protected)?\\s*(static)?\\s*(final)?\\s*String\\s+[A-Z_]+\\s*=\\s*[\"'][A-Za-z0-9+/=_-]{8,64}[\"']"
          
          # Weak algorithm configurations
          - "(?i)(algorithm|alg)\\s*[=:]\\s*[\"']?(none|HS256)[\"']?"
          
        condition: or

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - "(?i)jwt\\.(sign|verify|encode|decode)\\s*\\([^,]+,\\s*[\"']([A-Za-z0-9+/=_-]{8,64})[\"']"

  # Test for API endpoints that might expose JWT configuration
  - method: GET
    path:
      - "{{BaseURL}}/api/auth/config"
      - "{{BaseURL}}/api/jwt/config"
      - "{{BaseURL}}/api/token/config"
      - "{{BaseURL}}/auth/config"
      - "{{BaseURL}}/jwt/config"
      - "{{BaseURL}}/token/config"
      - "{{BaseURL}}/.well-known/jwks.json"
      - "{{BaseURL}}/.well-known/openid_configuration"
      - "{{BaseURL}}/oauth/.well-known/openid_configuration"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "application/json,text/plain,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # JSON response with JWT configuration
      - type: regex
        part: body
        regex:
          # JWKS with weak keys
          - '(?i)"kty"\\s*:\\s*"(oct|RSA)"'
          - '(?i)"k"\\s*:\\s*"[A-Za-z0-9+/=_-]{8,64}"'
          - '(?i)"alg"\\s*:\\s*"(none|HS256)"'
          
          # OpenID configuration with weak settings
          - '(?i)"id_token_signing_alg_values_supported"\\s*:\\s*\\[[^\\]]*"none"[^\\]]*\\]'
          - '(?i)"token_endpoint_auth_methods_supported"\\s*:\\s*\\[[^\\]]*"none"[^\\]]*\\]'
          
          # JWT configuration exposure
          - '(?i)"(secret|key|secretOrKey|secretOrPrivateKey|signing_key)"\\s*:\\s*"[A-Za-z0-9+/=_-]{8,64}"'
          - '(?i)"algorithm"\\s*:\\s*"(none|HS256)"'
          
        condition: or

    extractors:
      - type: regex
        part: body
        group: 2
        regex:
          - '(?i)"(secret|key|secretOrKey|secretOrPrivateKey|signing_key|k)"\\s*:\\s*"([A-Za-z0-9+/=_-]+)"'

  # Test for JWT tokens in responses (weak secrets can be cracked)
  - method: GET
    path:
      - "{{BaseURL}}/login"
      - "{{BaseURL}}/auth/login"
      - "{{BaseURL}}/api/login"
      - "{{BaseURL}}/api/auth/login"
      - "{{BaseURL}}/oauth/token"
      - "{{BaseURL}}/token"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "application/json,text/html,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 401
          - 403

      # JWT tokens in response
      - type: regex
        part: body
        regex:
          # JWT token pattern
          - "(?i)(token|access_token|id_token|refresh_token)\\s*[\":]\\s*[\"']?eyJ[A-Za-z0-9+/=_-]+\\.[A-Za-z0-9+/=_-]+\\.[A-Za-z0-9+/=_-]*[\"']?"
          
          # JWT in various formats
          - "eyJ[A-Za-z0-9+/=_-]+\\.[A-Za-z0-9+/=_-]+\\.[A-Za-z0-9+/=_-]*"
          
        condition: or

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - "(eyJ[A-Za-z0-9+/=_-]+\\.[A-Za-z0-9+/=_-]+\\.[A-Za-z0-9+/=_-]*)"

  # Test for debug/test endpoints with JWT information
  - method: GET
    path:
      - "{{BaseURL}}/debug"
      - "{{BaseURL}}/test"
      - "{{BaseURL}}/dev"
      - "{{BaseURL}}/development"
      - "{{BaseURL}}/api/debug"
      - "{{BaseURL}}/api/test"
      - "{{BaseURL}}/auth/debug"
      - "{{BaseURL}}/auth/test"
      - "{{BaseURL}}/jwt/debug"
      - "{{BaseURL}}/jwt/test"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "application/json,text/html,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # Debug information with JWT secrets
      - type: regex
        part: body
        regex:
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?[A-Za-z0-9+/=_-]{8,64}[\"']?"
          - "(?i)(secret|key|secretOrKey|secretOrPrivateKey)\\s*[=:]\\s*[\"']?[A-Za-z0-9+/=_-]{8,64}[\"']?"
          - '(?i)"(secret|key|secretOrKey|secretOrPrivateKey)"\\s*:\\s*"[A-Za-z0-9+/=_-]{8,64}"'
        condition: or

    extractors:
      - type: regex
        part: body
        group: 2
        regex:
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret|secret|key|secretOrKey|secretOrPrivateKey)\\s*[=:]\\s*[\"']?([A-Za-z0-9+/=_-]{8,64})[\"']?"

  # Test for configuration management files
  - method: GET
    path:
      - "{{BaseURL}}/ansible/vars/main.yml"
      - "{{BaseURL}}/ansible/group_vars/all.yml"
      - "{{BaseURL}}/terraform/variables.tf"
      - "{{BaseURL}}/terraform/terraform.tfvars"
      - "{{BaseURL}}/helm/values.yaml"
      - "{{BaseURL}}/k8s/configmap.yaml"
      - "{{BaseURL}}/k8s/secret.yaml"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "text/plain,application/x-yaml,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # Infrastructure as Code files with JWT secrets
      - type: regex
        part: body
        regex:
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?[A-Za-z0-9+/=_-]{8,64}[\"']?"
          - "(?i)(JWT_SECRET|JWT_KEY|SECRET_KEY|SIGNING_KEY|TOKEN_SECRET|AUTH_SECRET)\\s*[=:]\\s*[\"']?[A-Za-z0-9+/=_-]{8,64}[\"']?"
        condition: or

    extractors:
      - type: regex
        part: body
        group: 2
        regex:
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret|JWT_SECRET|JWT_KEY|SECRET_KEY|SIGNING_KEY|TOKEN_SECRET|AUTH_SECRET)\\s*[=:]\\s*[\"']?([A-Za-z0-9+/=_-]{8,64})[\"']?"

  # Test for backup and temporary files
  - method: GET
    path:
      - "{{BaseURL}}/jwt.bak"
      - "{{BaseURL}}/jwt.backup"
      - "{{BaseURL}}/jwt.old"
      - "{{BaseURL}}/auth.bak"
      - "{{BaseURL}}/auth.backup"
      - "{{BaseURL}}/auth.old"
      - "{{BaseURL}}/token.bak"
      - "{{BaseURL}}/token.backup"
      - "{{BaseURL}}/token.old"
      - "{{BaseURL}}/config.bak"
      - "{{BaseURL}}/config.backup"
      - "{{BaseURL}}/config.old"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      Accept: "text/plain,*/*"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # Backup files with JWT secrets
      - type: regex
        part: body
        regex:
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?[A-Za-z0-9+/=_-]{8,64}[\"']?"
        condition: or

    extractors:
      - type: regex
        part: body
        group: 2
        regex:
          - "(?i)(jwt_secret|jwt_key|secret_key|signing_key|token_secret|auth_secret)\\s*[=:]\\s*[\"']?([A-Za-z0-9+/=_-]{8,64})[\"']?"